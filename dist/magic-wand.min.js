MagicWand=function(){var t={};return t.floodFill=function(t,r,i,n,a,h){return h?function(t,r,i,n,a){var h,f,o,e,s,u,d,l,y,x,m=t.data,g=t.width,p=t.height,b=t.bytes,w=-1,M=g+1,c=-1,X=p+1,Y=i*g+r,v=new Uint8Array(g*p),A=new Uint8Array(a||g*p);if(1===A[Y])return null;var U=[m[Y*=b],m[Y+1],m[Y+2],m[Y+3]],q=[{y:i,left:r-1,right:r+1,dir:1}];do{for(e=q.shift(),x=!1,f=e.left+1;f<e.right;f++)if(d=e.y*g,Y=(d+f)*b,1!==A[d+f]&&(x=!0,v[d+f]=1,A[d+f]=1,h=m[Y]-U[0],!(n<h||h<-n||(h=m[Y+1]-U[1],n<h||h<-n||(h=m[Y+2]-U[2],n<h||h<-n))))){for(u=f-1;!(!(-1<u&&(Y=(l=d+u)*b,1!==A[l]))||(v[l]=1,A[l]=1,u--,h=m[Y]-U[0],n<h||h<-n)||(h=m[Y+1]-U[1],n<h||h<-n)||(h=m[Y+2]-U[2],n<h||h<-n)););for(s=f+1;!(!(s<g&&(Y=(y=d+s)*b,1!==A[y]))||(v[y]=1,A[y]=1,s++,h=m[Y]-U[0],n<h||h<-n)||(h=m[Y+1]-U[1],n<h||h<-n)||(h=m[Y+2]-U[2],n<h||h<-n)););u<M&&(M=u+1),w<s&&(w=s-1),0<=(o=e.y-e.dir)&&o<p&&(u<e.left&&q.push({y:o,left:u,right:e.left,dir:-e.dir}),e.right<s&&q.push({y:o,left:e.right,right:s,dir:-e.dir})),0<=(o=e.y+e.dir)&&o<p&&u<s&&q.push({y:o,left:u,right:s,dir:e.dir})}x&&(e.y<X&&(X=e.y),e.y>c&&(c=e.y))}while(0<q.length);return{data:v,width:t.width,height:t.height,bounds:{minX:M,minY:X,maxX:w,maxY:c}}}(t,r,i,n,a):function(t,r,i,n,a){var h,f,o,e,s,u,d,l,y,x,m=t.data,g=t.width,p=t.height,b=t.bytes,w=-1,M=g+1,c=-1,X=p+1,Y=i*g+r,v=new Uint8Array(g*p),A=new Uint8Array(a||g*p);if(1===A[Y])return null;var U=[m[Y*=b],m[Y+1],m[Y+2],m[Y+3]],q=[{y:i,left:r-1,right:r+1,dir:1}];do{for(e=q.shift(),x=!1,f=e.left+1;f<e.right;f++)if(d=e.y*g,Y=(d+f)*b,1!==A[d+f]&&(h=m[Y]-U[0],!(n<h||h<-n||(h=m[Y+1]-U[1],n<h||h<-n||(h=m[Y+2]-U[2],n<h||h<-n))))){for(x=!0,v[d+f]=1,A[d+f]=1,u=f-1;!(!(-1<u&&(Y=(l=d+u)*b,1!==A[l]))||(h=m[Y]-U[0],n<h||h<-n)||(h=m[Y+1]-U[1],n<h||h<-n)||(h=m[Y+2]-U[2],n<h||h<-n));)v[l]=1,A[l]=1,u--;for(s=f+1;!(!(s<g&&(Y=(y=d+s)*b,1!==A[y]))||(h=m[Y]-U[0],n<h||h<-n)||(h=m[Y+1]-U[1],n<h||h<-n)||(h=m[Y+2]-U[2],n<h||h<-n));)v[y]=1,A[y]=1,s++;u<M&&(M=u+1),w<s&&(w=s-1),0<=(o=e.y-e.dir)&&o<p&&(u<e.left&&q.push({y:o,left:u,right:e.left,dir:-e.dir}),e.right<s&&q.push({y:o,left:e.right,right:s,dir:-e.dir})),0<=(o=e.y+e.dir)&&o<p&&u<s&&q.push({y:o,left:u,right:s,dir:e.dir})}x&&(e.y<X&&(X=e.y),e.y>c&&(c=e.y))}while(0<q.length);return{data:v,width:t.width,height:t.height,bounds:{minX:M,minY:X,maxX:w,maxY:c}}}(t,r,i,n,a)},t.gaussBlur=function(t,r){var i,n,a,h,f,o,e,s=2*r+1,u=r*r,d=new Float32Array(s),l=0,y=t.width,x=t.height,m=t.data,g=t.bounds.minX,p=t.bounds.maxX,b=t.bounds.minY,w=t.bounds.maxY;for(i=0;i<r;i++){var M=(r-i)*(r-i),c=Math.exp(-M/(2*u))/(2*Math.PI*u);d[r+i]=d[r-i]=c,l+=2*c}for(i=0;i<s;i++)d[i]/=l;var X=new Uint8Array(y*x),Y=r+y,v=r+x;for(f=b;f<w+1;f++)for(h=g;h<p+1;h++){for(e=Y-h<s?Y-h:s,a=(n=f*y+h)-r,i=(o=0)<r-h?r-h:0;i<e;i++)o+=m[a+i]*d[i];for(e=v-f<s?v-f:s,a=n-r*y,i=0<r-f?r-f:0;i<e;i++)o+=m[a+i*y]*d[i];X[n]=.5<o?1:0}return{data:X,width:y,height:x,bounds:{minX:g,minY:b,maxX:p,maxY:w}}},t.gaussBlurOnlyBorder=function(t,r,i){var n,a,h,f,o,e,s,u,d,l,y=function(t,r,i){var n,a,h,f,o,e,s,u=t.width,d=t.height,l=t.data,y=new Uint8Array(l),x=t.bounds.minX,m=t.bounds.maxX,g=t.bounds.minY,p=t.bounds.maxY,b=u*d,w=new Uint8Array(b),M=[],c=Math.max(x,1),X=Math.min(m,u-2),Y=Math.max(g,1),v=Math.min(p,d-2);if(i&&0<i.length)for(o=0;o<b;o++)1===i[o]&&(y[o]=1);for(f=Y;f<v+1;f++)for(n=c;n<X+1;n++)0!==l[o=f*u+n]&&(e=o+u,s=o-u,0!==y[o+1]&&0!==y[o-1]&&0!==y[e]&&0!==y[e+1]&&0!==y[e-1]&&0!==y[s]&&0!==y[s+1]&&0!==y[s-1]||M.push(o));if(0==x)for(f=g;f<p+1;f++)1===l[f*u]&&M.push(f*u);if(m==u-1)for(f=g;f<p+1;f++)1===l[f*u+m]&&M.push(f*u+m);if(0==g)for(n=x;n<m+1;n++)1===l[n]&&M.push(n);if(p==d-1)for(n=x;n<m+1;n++)1===l[p*u+n]&&M.push(p*u+n);var A,U=[],q=r+u,B=r+d,k=2*r+1;for(b=M.length,h=0;h<b;h++){for(w[o=M[h]]=1,U.push(o),f=(o-(n=o%u))/u,A=q-n<k?q-n:k,e=o-r,a=0<r-n?r-n:0;a<A;a++)0===w[s=e+a]&&(w[s]=1,U.push(s));for(A=B-f<k?B-f:k,e=o-r*u,a=0<r-f?r-f:0;a<A;a++)0===w[s=e+a*u]&&(w[s]=1,U.push(s))}return U}(t,r,i),x=2*r+1,m=2*r*r,g=new Float32Array(x),p=0,b=t.width,w=t.height,M=t.data,c=t.bounds.minX,X=t.bounds.maxX,Y=t.bounds.minY,v=t.bounds.maxY,A=y.length;for(h=0;h<r;h++)a=(r-h)*(r-h),n=Math.exp(-a/m)/Math.PI,g[r+h]=g[r-h]=n,p+=2*n;for(h=0;h<x;h++)g[h]/=p;var U=new Uint8Array(M),q=r+b,B=r+w;for(h=0;h<A;h++){for(u=((o=y[h])-(s=o%b))/b,l=q-s<x?q-s:x,e=o-r,f=(d=0)<r-s?r-s:0;f<l;f++)d+=M[e+f]*g[f];if(.5<d)U[o]=1,s<c&&(c=s),X<s&&(X=s),u<Y&&(Y=u),v<u&&(v=u);else{for(l=B-u<x?B-u:x,e=o-r*b,f=0<r-u?r-u:0;f<l;f++)d+=M[e+f*b]*g[f];.5<d?(U[o]=1,s<c&&(c=s),X<s&&(X=s),u<Y&&(Y=u),v<u&&(v=u)):U[o]=0}}return{data:U,width:b,height:w,bounds:{minX:c,minY:Y,maxX:X,maxY:v}}},t.createBorderMask=function(t){var r,i,n,a,h,f=t.width,o=t.height,e=t.data,s=t.bounds.minX,u=t.bounds.maxX,d=t.bounds.minY,l=t.bounds.maxY,y=u-s+1,x=l-d+1,m=new Uint8Array(y*x),g=Math.max(s,1),p=Math.min(u,f-2),b=Math.max(d,1),w=Math.min(l,o-2);for(i=b;i<w+1;i++)for(r=g;r<p+1;r++)0!==e[n=i*f+r]&&(a=n+f,h=n-f,0!==e[n+1]&&0!==e[n-1]&&0!==e[a]&&0!==e[a+1]&&0!==e[a-1]&&0!==e[h]&&0!==e[1+h]&&0!==e[h-1]||(m[(i-d)*y+(r-s)]=1));if(0==s)for(i=d;i<l+1;i++)1===e[i*f]&&(m[(i-d)*y]=1);if(u==f-1)for(i=d;i<l+1;i++)1===e[i*f+u]&&(m[(i-d)*y+(u-s)]=1);if(0==d)for(r=s;r<u+1;r++)1===e[r]&&(m[r-s]=1);if(l==o-1)for(r=s;r<u+1;r++)1===e[l*f+r]&&(m[(l-d)*y+(r-s)]=1);return{data:m,width:y,height:x,offset:{x:s,y:d}}},t.getBorderIndices=function(t){var r,i,n,a,h,f=t.width,o=t.height,e=t.data,s=[],u=f-1,d=o-1;for(i=1;i<d;i++)for(r=1;r<u;r++)0!==e[n=i*f+r]&&(a=n+f,h=n-f,0!==e[n+1]&&0!==e[n-1]&&0!==e[a]&&0!==e[a+1]&&0!==e[a-1]&&0!==e[h]&&0!==e[1+h]&&0!==e[h-1]||s.push(n));for(i=0;i<o;i++)1===e[i*f]&&s.push(i*f);for(r=0;r<f;r++)1===e[r]&&s.push(r);for(n=f-1,i=0;i<o;i++)1===e[i*f+n]&&s.push(i*f+n);for(n=(o-1)*f,r=0;r<f;r++)1===e[n+r]&&s.push(n+r);return s},t.traceContours=function(t){var r,i,n,a,h,f,o,e,s,u,d,l,y,x,m,g=function(t){var r,i,n=t.width,a=t.data,h=t.bounds.minX,f=t.bounds.maxX,o=t.bounds.minY,e=t.bounds.maxY,s=f-h+3,u=e-o+3,d=new Uint8Array(s*u);for(i=o;i<e+1;i++)for(r=h;r<f+1;r++)1===a[i*n+r]&&(d[(i-o+1)*s+(r-h+1)]=1);return{data:d,width:s,height:u,offset:{x:h-1,y:o-1}}}(t),p=[],b=0,w=g.width,M=2*w,c=g.height,X=g.data,Y=g.offset.x,v=g.offset.y,A=new Uint8Array(X),U=[[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1],[1,-1]];for(a=1;a<c-1;a++)for(n=1;n<w-1;n++)if(1===X[h=a*w+n])for(r=-w;r<M;r+=M)if(0===X[h+r]&&0===A[h+r]){for(b++,o=[],s=(e=r===w)?2:6,l=y=u={x:n,y:a},d=null;;){for(A[l.y*w+l.x]=b,i=0;i<8;i++){if(m=U[s=(s+1)%8],1===X[f=(x={x:l.x+m[0],y:l.y+m[1]}).y*w+x.x]){A[f]=b;break}A[f]=-1,x=null}if(null===x)break;if(l=x,d){if(y.x===u.x&&y.y===u.y&&l.x===d.x&&l.y===d.y)break}else d=x;o.push({x:y.x+Y,y:y.y+v}),y=l,s=(s+4)%8}null!=x&&(o.push({x:u.x+Y,y:u.y+v}),p.push({inner:e,label:b,points:o}))}return p},t.simplifyContours=function(t,r,i){var n,a,h,f,o,e,s,u,d,l,y,x,m,g,p,b,w,M,c,X,Y,v=t.length,A=[];for(a=0;a<v;a++)if(o=(f=t[a]).points,(e=f.points.length)<i){for(s=[],h=0;h<e;h++)s.push({x:o[h].x,y:o[h].y});A.push({inner:f.inner,label:f.label,points:s,initialCount:e})}else{u=[0,e-1],d=[{first:0,last:e-1}];do{if(!((l=d.shift()).last<=l.first+1)){for(y=-1,x=l.first,n=l.first+1;n<l.last;n++)c=o[n],X=o[l.first],Y=o[l.last],w=c.x-X.x,M=c.y-X.y,g=Math.sqrt(w*w+M*M),w=c.x-Y.x,M=c.y-Y.y,p=Math.sqrt(w*w+M*M),w=X.x-Y.x,M=X.y-Y.y,b=Math.sqrt(w*w+M*M),y<(m=g>=Math.sqrt(p*p+b*b)?p:p>=Math.sqrt(g*g+b*b)?g:Math.abs((M*c.x-w*c.y+X.x*Y.y-Y.x*X.y)/b))&&(x=n,y=m);r<y&&(u.push(x),d.push({first:l.first,last:x}),d.push({first:x,last:l.last}))}}while(0<d.length);for(s=[],e=u.length,u.sort(function(t,r){return t-r}),h=0;h<e;h++)s.push({x:o[u[h]].x,y:o[u[h]].y});A.push({inner:f.inner,label:f.label,points:s,initialCount:f.points.length})}return A},t}(),module.exports=MagicWand;